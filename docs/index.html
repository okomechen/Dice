<!DOCTYPE html>
<meta charset="UTF-8" />
<html>
  <body>
    <button onclick="diceRoll()" id="diceRoll">まわす</button>
    <button onclick="append( '1' )" id="one">1</button>
    <button onclick="append( '2' )" id="two">2</button>
    <button onclick="append( '3' )" id="three">3</button>
    <button onclick="append( '4' )" id="four">4</button>
    <button onclick="append( '5' )" id="five">5</button>
    <button onclick="append( '6' )" id="six">6</button>
    <canvas id="canvas" width="500" height="500"></canvas><br />
    <p><img src="images/dice1.png" id="diceImage" style="display: none" />
    <style>
      button {
        width: 70px;
        height: 50px;
      }
    </style>
    <div id="nextOrder" style ="font-size:50px;">数字を予想してね</div>
    <input style="font-size: 28px; text-align: right" /><br />
    <script>
      let ctx;
      var nextOrder=document.getElementById("nextOrder");
      var img = document.getElementById("diceImage");//サイコロ画像用のid取得
      var idx = 0; //サイコロの目の変数
      var previdx = 0; //ひとつ前のサイコロの目
      var rouletteCount = 0;//何回サイコロを回したか

      function update(dice) {
        document.querySelector("input").value = dice;

      }

      function append(dice) {
        // 数字表示
        document.querySelector("input").value = dice;
        console.log(document.querySelector("input").value);
        nextOrder.innerHTML="ルーレットを回してね";
        return dice;//今予想している数字を返す
      }

      function diceStart() {
        const canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d");

        let img = document.getElementById("diceImage");
        ctx.drawImage(img, 100, 100, 300, 300);
      }

      function diceEnd() {
        ctx.clearRect(0, 0, 500, 500);
      }

      function diceRoll() {
        document.getElementById("diceRoll").disabled = true; //ルーレット中はボタンが押せない
        document.getElementById("one").disabled = true;
        document.getElementById("two").disabled = true;
        document.getElementById("three").disabled = true;
        document.getElementById("four").disabled = true;
        document.getElementById("five").disabled = true;
        document.getElementById("six").disabled = true;

        const intervalId = setInterval(() => {
          diceChange();

          if (rouletteCount > 15) {
            clearInterval(intervalId);
            rouletteCount = 0;
            document.getElementById("diceRoll").disabled = false;
            document.getElementById("one").disabled = false;
            document.getElementById("two").disabled = false;
            document.getElementById("three").disabled = false;
            document.getElementById("four").disabled = false;
            document.getElementById("five").disabled = false;
            document.getElementById("six").disabled = false;

            if(append()==idx){//予想したサイコロの目が一致していたら
              nextOrder.innerHTML="あたりだよ";
            }
            else nextOrder.innerHTML="はずれ";

          }
        }, 200); //15回実行して止める
      }

      function diceChange() {
        idx = Math.floor(Math.random() * 5) + 1; //次のサイコロの目
        while (previdx == idx) {
          idx = Math.floor(Math.random() * 5) + 1; //被ったら再抽選
        }
        previdx = idx;

        img.src = "images/dice" + idx + ".png"; //画像の指定
        console.log(rouletteCount++);
        diceStart();
      }
    </script>
  </body>
</html>
